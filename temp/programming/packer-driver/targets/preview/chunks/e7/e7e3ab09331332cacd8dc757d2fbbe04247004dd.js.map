{"version":3,"sources":["file:///D:/ThanhPhong/FE02/Project-FrontEnd2/assets/Scripts/UI/EventSystem.ts"],"names":["_decorator","Component","Input","input","KeyCode","log","UISelectable","UIIndicator","ccclass","property","EventSystem","type","RecoverFocus","submitAction","onLoad","instance","on","EventType","KEY_DOWN","KeyboardOnKeyDown","GAMEPAD_INPUT","GamePadOnKeyDown","start","event","CurrentSelected","leftAction","gamepad","dpad","left","getValue","rightAction","right","upAction","up","downAction","down","buttonSouth","OnSubmit","SelectOnLeft","ChangeCurrentSelected","selectLeft","SelectOnRight","selectRight","SelectOnUp","selectUp","SelectOnDown","selectDown","keyCode","ARROW_LEFT","KEY_A","ARROW_RIGHT","KEY_D","ARROW_UP","KEY_W","ARROW_DOWN","KEY_S","ENTER","SPACE","newSelected","OnSelect","Indicator","ChangeParent","onDisable","update","dt"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventGamepad, EventKeyboard, Input, input, KeyCode, log, Node } from 'cc';\nimport { UISelectable } from './UISelectable';\nimport { UIIndicator } from './UIIndicator';\nimport { AndroidNative } from '../Android/AndroidNative';\nconst { ccclass, property } = _decorator;\n\n@ccclass('EventSystem')\nexport class EventSystem extends Component\n{\n\n    public static instance: EventSystem = null;\n\n    @property({ type: UISelectable })\n    public FirstSelected: UISelectable = null;\n\n    @property({ type: UISelectable })\n    public CurrentSelected: UISelectable = null;\n\n    @property({ type: UIIndicator })\n    public Indicator: UIIndicator = null;\n\n    public RecoverFocus: boolean = true;\n\n    onLoad () \n    {\n        if (EventSystem.instance == null)\n        {\n            EventSystem.instance = this;\n        }\n        input.on(Input.EventType.KEY_DOWN, this.KeyboardOnKeyDown, this);\n        input.on(Input.EventType.GAMEPAD_INPUT, this.GamePadOnKeyDown, this);\n    }\n\n    protected start (): void \n    {\n    }\n    private submitAction: boolean = false;\n\n    private GamePadOnKeyDown (event: EventGamepad): void\n    {\n        if (this.CurrentSelected == null)\n        {\n            return;\n        }\n\n        let leftAction = event.gamepad.dpad.left.getValue() == 1;\n        let rightAction = event.gamepad.dpad.right.getValue() == 1;\n        let upAction = event.gamepad.dpad.up.getValue() == 1;\n        let downAction = event.gamepad.dpad.down.getValue() == 1;\n        \n\n        if (event.gamepad.buttonSouth.getValue() == 1 && !this.submitAction)\n        {\n            this.CurrentSelected.OnSubmit();\n        }\n        else if(event.gamepad.buttonSouth.getValue() == 0 && this.submitAction)\n        {\n            log(\"Not Submit\");\n            this.submitAction = false;\n        }\n\n        if (leftAction && this.CurrentSelected.SelectOnLeft != null)\n        {\n            this.ChangeCurrentSelected(this.CurrentSelected.selectLeft);\n        }\n        else if (rightAction && this.CurrentSelected.SelectOnRight != null)\n        {\n            this.ChangeCurrentSelected(this.CurrentSelected.selectRight);\n        }\n\n        if (upAction && this.CurrentSelected.SelectOnUp != null)\n        {\n            this.ChangeCurrentSelected(this.CurrentSelected.selectUp);\n        }\n        else if (downAction && this.CurrentSelected.SelectOnDown != null)\n        {\n            this.ChangeCurrentSelected(this.CurrentSelected.selectDown);\n        }\n    }\n\n    //Handle Keyboard Input\n    private KeyboardOnKeyDown (event: EventKeyboard): void\n    {\n        if (this.CurrentSelected == null)\n        {\n            log(\"No Current Selected\");\n            return;\n        }\n\n        let leftAction = false;\n        if (event.keyCode == (KeyCode.ARROW_LEFT) || event.keyCode == (KeyCode.KEY_A)) \n        {\n            leftAction = true;\n        }\n\n        let rightAction = false;\n        if (event.keyCode == (KeyCode.ARROW_RIGHT) || event.keyCode == (KeyCode.KEY_D))\n        {\n            rightAction = true;\n        }\n\n        let upAction = false;\n        if (event.keyCode == (KeyCode.ARROW_UP) || event.keyCode == (KeyCode.KEY_W))\n        {\n            upAction = true;\n        }\n\n        let downAction = false;\n        if (event.keyCode == (KeyCode.ARROW_DOWN) || event.keyCode == (KeyCode.KEY_S))\n        {\n            downAction = true;\n        }\n\n        let submitAction = false;\n        if (event.keyCode == (KeyCode.ENTER) || event.keyCode == (KeyCode.SPACE))\n        {\n            submitAction = true;\n        }\n\n        if (submitAction)\n        {\n            this.CurrentSelected.OnSubmit();\n        }\n\n        if (leftAction)\n        {\n            if (this.CurrentSelected.SelectOnLeft != null)\n            {\n                this.ChangeCurrentSelected(this.CurrentSelected.selectLeft);\n            }\n        }\n        else if (rightAction)\n        {\n            if (this.CurrentSelected.SelectOnRight != null)\n            {\n                this.ChangeCurrentSelected(this.CurrentSelected.selectRight);\n            }\n        }\n        else if (upAction)\n        {\n            if (this.CurrentSelected.SelectOnUp != null)\n            {\n                this.ChangeCurrentSelected(this.CurrentSelected.selectUp);\n            }\n        }\n        else if (downAction)\n        {\n            if (this.CurrentSelected.SelectOnDown != null)\n            {\n                this.ChangeCurrentSelected(this.CurrentSelected.selectDown);\n            }\n        }\n    }\n\n    public ChangeCurrentSelected (newSelected: UISelectable): void\n    {\n        this.CurrentSelected = newSelected;\n        this.CurrentSelected.OnSelect();\n        this.Indicator.ChangeParent(this.CurrentSelected);\n    }\n\n\n    protected onDisable (): void \n    {\n        if (EventSystem.instance == this)\n        {\n            EventSystem.instance = null;\n        }\n    }\n\n    protected update (dt: number): void \n    {\n        if (this.RecoverFocus)\n        {\n            if (this.CurrentSelected == null)\n            {\n\n            }\n        }\n    }\n}\n\n\n"]}